<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>隨機問答測驗</title>
</head>
<body>

<h1>隨機問答測驗</h1>
<div id="quiz"></div>
<button id="submitBtn">提交答案</button>
<div id="results"></div>

<script>
async function loadQuestions() {
  const res = await fetch('questions.json');
  const questionBank = await res.json();
  buildQuiz(questionBank);
}

function getRandomQuestions(arr, n) {
  return arr.sort(() => 0.5 - Math.random()).slice(0, n);
}

function getOptions(correct, allAnswers) {
  let options = [correct];
  let wrongAnswers = allAnswers.filter(a => a !== correct);
  wrongAnswers = wrongAnswers.sort(() => 0.5 - Math.random()).slice(0, 3);
  options = options.concat(wrongAnswers);
  return options.sort(() => 0.5 - Math.random());
}

let selectedQuestions = [];

function buildQuiz(questionBank) {
  const quizContainer = document.getElementById("quiz");
  const allAnswers = questionBank.map(q => q.answer);
  selectedQuestions = getRandomQuestions(questionBank, 10);

  quizContainer.innerHTML = "";
  selectedQuestions.forEach((q, index) => {
    const qElem = document.createElement("div");
    qElem.innerHTML = `<p>${index + 1}. ${q.question}</p>`;

    const options = getOptions(q.answer, allAnswers);
    options.forEach(option => {
      qElem.innerHTML += `<label><input type="radio" name="q${index}" value="${option}"> ${option}</label><br>`;
    });

    quizContainer.appendChild(qElem);
  });
}

document.getElementById("submitBtn").addEventListener("click", () => {
  const resultsContainer = document.getElementById("results");
  resultsContainer.innerHTML = "<h2>正確答案</h2>";
  
  selectedQuestions.forEach((q, index) => {
    const selected = document.querySelector(`input[name="q${index}"]:checked`);
    const isCorrect = selected && selected.value === q.answer;
    resultsContainer.innerHTML += `
      <p>${index + 1}. ${q.question}</p>
      <img src="${q.image}" alt="正確答案" width="200"><br>
      你的答案：${selected ? selected.value : "未作答"} → ${isCorrect ? "✅" : "❌"}
      <hr>
    `;
  });
});

loadQuestions();
</script>

</body>
</html>
